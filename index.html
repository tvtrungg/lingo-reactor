<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>French Reflex - Luy·ªán Ph·∫£n X·∫° Ti·∫øng Ph√°p</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
        }

        .logo {
            font-size: 20px;
            font-weight: bold;
            color: #6d6d6d;
            text-align: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 900px;
            width: 90%;
            text-align: center;
        }

        h1 {
            color: #4a5568;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .tab-buttons {
            display: flex;
            justify-content: center;
            margin: 30px 0;
            background: #f7fafc;
            border-radius: 15px;
            padding: 5px;
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            margin: 0 5px;
        }

        .tab-btn.active {
            background: #4299e1;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(66, 153, 225, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4a5568;
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .btn {
            background: linear-gradient(45deg, #4299e1, #667eea);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            font-weight: bold;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(66, 153, 225, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: linear-gradient(45deg, #e53e3e, #fc8181);
        }

        .btn-success {
            background: linear-gradient(45deg, #38a169, #68d391);
        }

        .game-area {
            background: #f7fafc;
            border-radius: 15px;
            padding: 40px;
            margin: 20px 0;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .word-display {
            font-size: 3em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4299e1, #667eea);
            transition: width 0.3s ease;
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stats-card {
            background: linear-gradient(135deg, #e6fffa, #b2f5ea);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid #4fd1c7;
        }

        .stats-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #065f46;
            margin-bottom: 10px;
        }

        .stats-label {
            color: #047857;
            font-weight: bold;
        }

        .collection-list,
        .word-list {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            text-align: left;
            max-height: 500px;
            overflow-y: auto;
        }

        .collection-item,
        .word-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
            transition: background-color 0.3s ease;
        }

        .collection-item:hover,
        .word-item:hover {
            background: #edf2f7;
        }

        .collection-item:last-child,
        .word-item:last-child {
            border-bottom: none;
        }

        .delete-btn {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .answer-display {
            background: #e6fffa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid #4fd1c7;
        }

        .answer-french {
            font-size: 1.8em;
            font-weight: bold;
            color: #065f46;
            margin-bottom: 10px;
        }

        .answer-vietnamese {
            font-size: 1.2em;
            color: #047857;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            cursor: pointer;
            background: #f7fafc;
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            width: 100%;
        }

        .file-input-wrapper:hover {
            border-color: #4299e1;
            background: #ebf8ff;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #38a169;
        }

        .notification.error {
            background: #e53e3e;
        }

        .notification.info {
            background: #4299e1;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 20px;
            max-width: 900px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .modal-close {
            float: right;
            font-size: 24px;
            cursor: pointer;
            color: #4a5568;
        }

        .modal-close:hover {
            color: #e53e3e;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                width: 95%;
            }

            .word-display {
                font-size: 2em;
            }

            .tab-buttons {
                flex-wrap: wrap;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üá´üá∑ French Reflex</h1>
        <i class="logo">(tvtrung)</i>

        <div class="tab-buttons">
            <button class="tab-btn active" onclick="showTab('setup')">Thi·∫øt l·∫≠p</button>
            <button class="tab-btn" onclick="showTab('collection')">Collection</button>
            <button class="tab-btn" onclick="showTab('game')">Ch∆°i game</button>
            <button class="tab-btn" onclick="showTab('stats')">Th·ªëng k√™</button>
        </div>

        <!-- Tab Thi·∫øt l·∫≠p -->
        <div id="setup" class="tab-content active">
            <div class="settings-grid">
                <div class="form-group">
                    <label for="displayTime">Th·ªùi gian hi·ªÉn th·ªã (gi√¢y):</label>
                    <input type="number" id="displayTime" min="0.5" max="10" step="0.1" value="2">
                </div>
                <div class="form-group">
                    <label for="answerDisplayTime">Th·ªùi gian hi·ªÉn th·ªã ƒë√°p √°n (gi√¢y):</label>
                    <input type="number" id="answerDisplayTime" min="1" max="10" step="0.1" value="3">
                </div>
                <div class="form-group">
                    <label for="gameMode">Ch·∫ø ƒë·ªô ch∆°i:</label>
                    <select id="gameMode">
                        <option value="vietnamese-to-french">Ti·∫øng Vi·ªát ‚Üí Ti·∫øng Ph√°p</option>
                        <option value="french-to-vietnamese">Ti·∫øng Ph√°p ‚Üí Ti·∫øng Vi·ªát</option>
                        <option value="mixed">Tr·ªôn l·∫´n</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="repeatCount">S·ªë l·∫ßn l·∫∑p m·ªói t·ª´:</label>
                    <input type="number" id="repeatCount" min="1" max="10" value="1">
                </div>
            </div>

            <div class="form-group">
                <label for="collectionSelect">Ch·ªçn Collection:</label>
                <select id="collectionSelect">
                    <option value="">-- Ch·ªçn ho·∫∑c t·∫°o m·ªõi --</option>
                </select>
            </div>
            <div class="form-group">
                <label for="newCollectionName">T√™n Collection m·ªõi (n·∫øu c√≥):</label>
                <input type="text" id="newCollectionName" placeholder="Nh·∫≠p t√™n Collection m·ªõi">
            </div>
            <div class="form-group">
                <label for="wordInput">Nh·∫≠p t·ª´ v·ª±ng (m·ªói d√≤ng: Ti·∫øng Vi·ªát | Ti·∫øng Ph√°p):</label>
                <textarea id="wordInput" placeholder="V√≠ d·ª•:
Xin ch√†o | Bonjour
T·∫°m bi·ªát | Au revoir
C·∫£m ∆°n | Merci
Xin l·ªói | Excusez-moi
T√¥i y√™u b·∫°n | Je t'aime"></textarea>
            </div>

            <div class="form-group">
                <label>Ho·∫∑c t·∫£i file JSON:</label>
                <div class="file-input-wrapper">
                    <input type="file" id="fileInput" accept=".json">
                    <span>üìÅ Ch·ªçn file JSON ho·∫∑c k√©o th·∫£ v√†o ƒë√¢y</span>
                </div>
            </div>

            <button class="btn" onclick="addWords()">Th√™m t·ª´ v·ª±ng</button>
        </div>

        <!-- Tab Collection -->
        <div id="collection" class="tab-content">
            <div class="form-group">
                <h3 style="margin-bottom: 20px; color: #4a5568;">üìö Danh s√°ch Collection</h3>
                <button class="btn btn-success" onclick="saveToFile()">üíæ L∆∞u danh s√°ch</button>
                <button class="btn btn-danger" onclick="clearCollections()">üóëÔ∏è X√≥a t·∫•t c·∫£</button>
            </div>

            <div id="collectionList" class="collection-list"></div>

            <div
                style="margin-top: 20px; padding: 20px; background: #f0f9ff; border-radius: 10px; border-left: 4px solid #0ea5e9;">
                <p style="margin: 0; color: #0369a1;">
                    üí° <strong>H∆∞·ªõng d·∫´n:</strong> Nh·∫•p v√†o m·ªôt Collection ƒë·ªÉ xem t·ª´ v·ª±ng. ƒê·ªÉ th√™m t·ª´ v·ª±ng, h√£y chuy·ªÉn
                    sang tab "Thi·∫øt l·∫≠p" v√† nh·∫≠p t·ª´ v·ª±ng theo ƒë·ªãnh d·∫°ng: <strong>Ti·∫øng Vi·ªát | Ti·∫øng Ph√°p</strong>
                </p>
            </div>
        </div>

        <!-- Tab Ch∆°i game -->
        <div id="game" class="tab-content">
            <div class="form-group">
                <label for="gameCollectionSelect">Ch·ªçn Collection ƒë·ªÉ ch∆°i:</label>
                <select id="gameCollectionSelect">
                    <option value="">-- T·∫•t c·∫£ t·ª´ v·ª±ng --</option>
                </select>
            </div>
            <div class="game-area">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>

                <div id="gameDisplay">
                    <div class="word-display" id="wordDisplay">Nh·∫•n "B·∫Øt ƒë·∫ßu" ƒë·ªÉ ch∆°i</div>
                </div>

                <div class="game-controls">
                    <button class="btn btn-success" id="startBtn" onclick="startGame()">‚ñ∂Ô∏è B·∫Øt ƒë·∫ßu</button>
                    <button class="btn btn-danger" id="stopBtn" onclick="stopGame()" disabled>‚èπÔ∏è D·ª´ng</button>
                </div>

                <div id="answerDisplay" class="answer-display" style="display: none;"></div>
            </div>
        </div>

        <!-- Tab Th·ªëng k√™ -->
        <div id="stats" class="tab-content">
            <div class="settings-grid">
                <div class="stats-card">
                    <div class="stats-number" id="totalWords">0</div>
                    <div class="stats-label">T·ªïng t·ª´ v·ª±ng</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number" id="totalCollections">0</div>
                    <div class="stats-label">T·ªïng Collection</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number" id="totalSessions">0</div>
                    <div class="stats-label">L·∫ßn ch∆°i</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number" id="totalWordsShown">0</div>
                    <div class="stats-label">T·ª´ ƒë√£ hi·ªÉn th·ªã</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number" id="averageTime">0s</div>
                    <div class="stats-label">Th·ªùi gian TB</div>
                </div>
            </div>

            <button class="btn btn-danger" onclick="resetStats()">üîÑ ƒê·∫∑t l·∫°i th·ªëng k√™</button>
        </div>
        <div id="collectionModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="modal-close" onclick="closeModal()">&times;</span>
                <h3 id="modalTitle" style="margin-bottom: 20px; color: #4a5568;"></h3>
                <div id="modalWordList" class="word-list"></div>
            </div>
        </div>
    </div>

    <script>
        let collections = [];
        let words = [];
        let currentGameWords = [];
        let currentWordIndex = 0;
        let isGameRunning = false;
        let gameInterval;
        let gamePhase = 'question'; // 'question' or 'answer'
        let gameStats = {
            totalSessions: 0,
            totalWordsShown: 0,
            totalTime: 0
        };

        // Kh·ªüi t·∫°o ·ª©ng d·ª•ng
        function init() {
            loadCollections();
            loadStats();
            updateCollectionList();
            updateCollectionSelects();
            updateStats();
            setupFileInput();
        }

        // Chuy·ªÉn ƒë·ªïi tab
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab-btn[onclick="showTab('${tabName}')"]`).classList.add('active');

            if (tabName === 'collection') {
                updateCollectionList();
            }
        }

        // Th√™m t·ª´ v·ª±ng
        function addWords() {
            const input = document.getElementById('wordInput').value.trim();
            const collectionSelect = document.getElementById('collectionSelect').value;
            const newCollectionName = document.getElementById('newCollectionName').value.trim();

            if (!input) {
                showNotification('Vui l√≤ng nh·∫≠p t·ª´ v·ª±ng!', 'error');
                return;
            }

            let collectionId = collectionSelect;
            if (newCollectionName && !collectionSelect) {
                collectionId = Date.now().toString();
                collections.push({
                    id: collectionId,
                    name: newCollectionName,
                    words: []
                });
                showNotification(`ƒê√£ t·∫°o Collection m·ªõi: ${newCollectionName}`, 'success');
            } else if (!collectionSelect) {
                showNotification('Vui l√≤ng ch·ªçn ho·∫∑c t·∫°o m·ªõi m·ªôt Collection!', 'error');
                return;
            }

            const lines = input.split('\n');
            let addedCount = 0;

            lines.forEach(line => {
                const parts = line.split('|');
                if (parts.length === 2) {
                    const vietnamese = parts[0].trim();
                    const french = parts[1].trim();

                    if (vietnamese && french) {
                        const word = { vietnamese, french };
                        const collection = collections.find(c => c.id === collectionId);
                        if (collection) {
                            if (!collection.words.some(w => w.vietnamese === vietnamese && w.french === french)) {
                                collection.words.push(word);
                                addedCount++;
                            }
                        }
                        if (!words.some(w => w.vietnamese === vietnamese && w.french === french)) {
                            words.push(word);
                        }
                    }
                }
            });

            if (addedCount > 0) {
                document.getElementById('wordInput').value = '';
                document.getElementById('newCollectionName').value = '';
                saveCollections();
                saveWords();
                updateCollectionList();
                updateCollectionSelects();
                updateStats();
                showNotification(`ƒê√£ th√™m ${addedCount} t·ª´ v·ª±ng v√†o Collection!`, 'success');
                showTab('collection');
            } else {
                showNotification('Kh√¥ng c√≥ t·ª´ v·ª±ng h·ª£p l·ªá n√†o ƒë∆∞·ª£c th√™m!', 'error');
            }
        }

        // X√≥a t·∫•t c·∫£ Collection
        function clearCollections() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ Collection?')) {
                collections = [];
                words = [];
                saveCollections();
                saveWords();
                updateCollectionList();
                updateCollectionSelects();
                updateStats();
                showNotification('ƒê√£ x√≥a t·∫•t c·∫£ Collection!', 'info');
            }
        }

        // X√≥a m·ªôt Collection
        function deleteCollection(id) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a Collection n√†y?')) {
                collections = collections.filter(c => c.id !== id);
                words = words.filter(w => !collections.some(c => c.words.some(cw => cw.vietnamese === w.vietnamese && cw.french === w.french)));
                saveCollections();
                saveWords();
                updateCollectionList();
                updateCollectionSelects();
                updateStats();
                showNotification('ƒê√£ x√≥a Collection!', 'info');
            }
        }

        // X√≥a m·ªôt t·ª´ v·ª±ng
        function deleteWord(collectionId, index) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·ª´ n√†y?')) {
                const collection = collections.find(c => c.id === collectionId);
                if (collection) {
                    const [removedWord] = collection.words.splice(index, 1);
                    words = words.filter(w => !(w.vietnamese === removedWord.vietnamese && w.french === removedWord.french));
                    saveCollections();
                    saveWords();
                    updateCollectionList();
                    updateStats();
                    showNotification('ƒê√£ x√≥a t·ª´ v·ª±ng!', 'info');
                }
            }
        }

        // C·∫≠p nh·∫≠t danh s√°ch Collection
        function updateCollectionList() {
            const collectionListDiv = document.getElementById('collectionList');
            if (collections.length === 0) {
                collectionListDiv.innerHTML = '<p style="text-align: center; color: #666;">Ch∆∞a c√≥ Collection n√†o. H√£y th√™m t·ª´ v·ª±ng ƒë·ªÉ t·∫°o!</p>';
                return;
            }

            collectionListDiv.innerHTML = collections.map(collection => `
                <div class="collection-item" onclick="showCollectionWords('${collection.id}')" style="cursor: pointer;">
                    <span >
                        <strong>${collection.name}</strong> (${collection.words.length} t·ª´)
                    </span>
                    <button class="delete-btn" onclick="deleteCollection('${collection.id}')">X√≥a</button>
                </div>
            `).join('');
        }

        // Hi·ªÉn th·ªã t·ª´ v·ª±ng trong Collection qua Modal
        function showCollectionWords(collectionId) {
            const collection = collections.find(c => c.id === collectionId);
            if (!collection) return;

            const modal = document.getElementById('collectionModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalWordList = document.getElementById('modalWordList');

            modalTitle.textContent = collection.name;
            modalWordList.innerHTML = collection.words.length === 0 ?
                '<p style="text-align: center; color: #666;">Ch∆∞a c√≥ t·ª´ v·ª±ng trong Collection n√†y.</p>' :
                collection.words.map((word, index) => `
                    <div class="word-item">
                        <span><strong>${word.vietnamese}</strong> ‚Üí ${word.french}</span>
                        <button class="delete-btn" onclick="deleteWord('${collectionId}', ${index}); closeModal();">X√≥a</button>
                    </div>
                `).join('');

            modal.style.display = 'flex';
        }

        // ƒê√≥ng Modal
        function closeModal() {
            document.getElementById('collectionModal').style.display = 'none';
            updateCollectionList(); // C·∫≠p nh·∫≠t l·∫°i danh s√°ch Collection khi ƒë√≥ng modal
        }

        // C·∫≠p nh·∫≠t danh s√°ch Collection trong select box
        function updateCollectionSelects() {
            const collectionSelect = document.getElementById('collectionSelect');
            const gameCollectionSelect = document.getElementById('gameCollectionSelect');
            const options = collections.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            collectionSelect.innerHTML = '<option value="">-- Ch·ªçn ho·∫∑c t·∫°o m·ªõi --</option>' + options;
            gameCollectionSelect.innerHTML = '<option value="">-- T·∫•t c·∫£ t·ª´ v·ª±ng --</option>' + options;
        }

        // B·∫Øt ƒë·∫ßu game
        function startGame() {
            const collectionId = document.getElementById('gameCollectionSelect').value;
            const repeatCount = parseInt(document.getElementById('repeatCount').value) || 1;

            let gameWords = collectionId ?
                collections.find(c => c.id === collectionId)?.words || [] :
                [...words];

            if (gameWords.length === 0) {
                showNotification('Vui l√≤ng th√™m t·ª´ v·ª±ng tr∆∞·ªõc khi ch∆°i!', 'error');
                return;
            }

            isGameRunning = true;
            gamePhase = 'question';
            currentWordIndex = 0;
            currentGameWords = [];

            // T·∫°o danh s√°ch t·ª´ v·ªõi s·ªë l·∫ßn l·∫∑p
            for (let i = 0; i < repeatCount; i++) {
                const shuffled = [...gameWords].sort(() => Math.random() - 0.5);
                currentGameWords.push(...shuffled);
            }

            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;

            gameStats.totalSessions++;
            saveStats();
            updateStats();

            showNextWord();
        }

        // D·ª´ng game
        function stopGame() {
            isGameRunning = false;
            clearInterval(gameInterval);

            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('answerDisplay').style.display = 'none';

            document.getElementById('wordDisplay').textContent = 'Game ƒë√£ d·ª´ng';
            document.getElementById('progressFill').style.width = '0%';

            showNotification('Game ƒë√£ d·ª´ng!', 'info');
        }

        // Hi·ªÉn th·ªã t·ª´ ti·∫øp theo
        function showNextWord() {
            if (!isGameRunning || currentWordIndex >= currentGameWords.length) {
                stopGame();
                showNotification('ƒê√£ ho√†n th√†nh t·∫•t c·∫£ t·ª´ v·ª±ng!', 'success');
                return;
            }

            const currentWord = currentGameWords[currentWordIndex];
            const displayTime = parseFloat(document.getElementById('displayTime').value) * 1000;
            const answerDisplayTime = parseFloat(document.getElementById('answerDisplayTime').value) * 1000;
            const gameMode = document.getElementById('gameMode').value;

            if (gamePhase === 'question') {
                document.getElementById('answerDisplay').style.display = 'none';

                let displayText = '';
                if (gameMode === 'vietnamese-to-french') {
                    displayText = currentWord.vietnamese;
                } else if (gameMode === 'french-to-vietnamese') {
                    displayText = currentWord.french;
                } else {
                    displayText = Math.random() > 0.5 ? currentWord.vietnamese : currentWord.french;
                }

                document.getElementById('wordDisplay').textContent = displayText;

                const progress = ((currentWordIndex + 1) / currentGameWords.length) * 100;
                document.getElementById('progressFill').style.width = progress + '%';

                gameStats.totalWordsShown++;
                gameStats.totalTime += displayTime;
                saveStats();
                updateStats();

                gamePhase = 'answer';
                gameInterval = setTimeout(() => {
                    showCurrentAnswer();
                }, displayTime);
            } else if (gamePhase === 'answer') {
                currentWordIndex++;
                gamePhase = 'question';
                gameInterval = setTimeout(() => {
                    showNextWord();
                }, answerDisplayTime);
            }
        }

        // Hi·ªÉn th·ªã ƒë√°p √°n c·ªßa t·ª´ hi·ªán t·∫°i
        function showCurrentAnswer() {
            if (!isGameRunning || currentWordIndex >= currentGameWords.length) return;

            const currentWord = currentGameWords[currentWordIndex];
            const gameMode = document.getElementById('gameMode').value;
            const currentDisplay = document.getElementById('wordDisplay').textContent;

            let answerHTML = '';
            if (gameMode === 'vietnamese-to-french') {
                answerHTML = `
                    <div class="answer-french">${currentWord.french}</div>
                    <div class="answer-vietnamese">${currentWord.vietnamese}</div>
                `;
            } else if (gameMode === 'french-to-vietnamese') {
                answerHTML = `
                    <div class="answer-french">${currentWord.vietnamese}</div>
                    <div class="answer-vietnamese">${currentWord.french}</div>
                `;
            } else {
                if (currentDisplay === currentWord.vietnamese) {
                    answerHTML = `
                        <div class="answer-french">${currentWord.french}</div>
                        <div class="answer-vietnamese">${currentWord.vietnamese}</div>
                    `;
                } else {
                    answerHTML = `
                        <div class="answer-french">${currentWord.vietnamese}</div>
                        <div class="answer-vietnamese">${currentWord.french}</div>
                    `;
                }
            }

            document.getElementById('answerDisplay').innerHTML = answerHTML;
            document.getElementById('answerDisplay').style.display = 'block';

            showNextWord();
        }

        // L∆∞u Collections
        function saveCollections() {
            localStorage.setItem('frenchCollections', JSON.stringify(collections));
        }

        // T·∫£i Collections
        function loadCollections() {
            const savedCollections = localStorage.getItem('frenchCollections');
            if (savedCollections) {
                collections = JSON.parse(savedCollections);
                collections.forEach(c => {
                    c.words.forEach(w => {
                        if (!words.some(wd => wd.vietnamese === w.vietnamese && wd.french === w.french)) {
                            words.push(w);
                        }
                    });
                });
            }
        }

        // L∆∞u t·ª´ v·ª±ng
        function saveWords() {
            localStorage.setItem('frenchWords', JSON.stringify(words));
        }

        // T·∫£i t·ª´ v·ª±ng
        function loadWords() {
            const savedWords = localStorage.getItem('frenchWords');
            if (savedWords) {
                words = JSON.parse(savedWords);
            }
        }

        // L∆∞u th·ªëng k√™
        function saveStats() {
            localStorage.setItem('frenchGameStats', JSON.stringify(gameStats));
        }

        // T·∫£i th·ªëng k√™
        function loadStats() {
            const savedStats = localStorage.getItem('frenchGameStats');
            if (savedStats) {
                gameStats = JSON.parse(savedStats);
            }
        }

        // C·∫≠p nh·∫≠t th·ªëng k√™
        function updateStats() {
            document.getElementById('totalWords').textContent = words.length;
            document.getElementById('totalCollections').textContent = collections.length;
            document.getElementById('totalSessions').textContent = gameStats.totalSessions;
            document.getElementById('totalWordsShown').textContent = gameStats.totalWordsShown;

            const avgTime = gameStats.totalWordsShown > 0 ?
                (gameStats.totalTime / gameStats.totalWordsShown / 1000).toFixed(1) : 0;
            document.getElementById('averageTime').textContent = avgTime + 's';
        }

        // ƒê·∫∑t l·∫°i th·ªëng k√™
        function resetStats() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒë·∫∑t l·∫°i t·∫•t c·∫£ th·ªëng k√™?')) {
                gameStats = {
                    totalSessions: 0,
                    totalWordsShown: 0,
                    totalTime: 0
                };
                saveStats();
                updateStats();
                showNotification('ƒê√£ ƒë·∫∑t l·∫°i th·ªëng k√™!', 'info');
            }
        }

        // L∆∞u danh s√°ch t·ª´ v·ª±ng ra file JSON
        function saveToFile() {
            if (collections.length === 0) {
                showNotification('Kh√¥ng c√≥ Collection n√†o ƒë·ªÉ l∆∞u!', 'error');
                return;
            }

            const dataStr = JSON.stringify(collections, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);

            const exportFileDefaultName = 'french-collections.json';
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();

            showNotification('ƒê√£ l∆∞u file th√†nh c√¥ng!', 'success');
        }

        // Thi·∫øt l·∫≠p file input
        function setupFileInput() {
            const fileInput = document.getElementById('fileInput');
            fileInput.addEventListener('change', handleFileSelect);
        }

        // X·ª≠ l√Ω file ƒë∆∞·ª£c ch·ªçn
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file && file.type === 'application/json') {
                const reader = new FileReader();
                reader.onload = function (e) {
                    try {
                        const importedCollections = JSON.parse(e.target.result);
                        if (Array.isArray(importedCollections)) {
                            collections = importedCollections;
                            words = [];
                            collections.forEach(c => {
                                c.words.forEach(w => {
                                    if (!words.some(wd => wd.vietnamese === w.vietnamese && wd.french === w.french)) {
                                        words.push(w);
                                    }
                                });
                            });
                            saveCollections();
                            saveWords();
                            updateCollectionList();
                            updateCollectionSelects();
                            updateStats();
                            showNotification(`ƒê√£ t·∫£i ${collections.length} Collection!`, 'success');
                            showTab('collection');
                        } else {
                            showNotification('File JSON kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng!', 'error');
                        }
                    } catch (error) {
                        showNotification('L·ªói khi ƒë·ªçc file JSON!', 'error');
                    }
                };
                reader.readAsText(file);
            } else {
                showNotification('Vui l√≤ng ch·ªçn file JSON!', 'error');
            }
        }

        // Hi·ªÉn th·ªã th√¥ng b√°o
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Kh·ªüi t·∫°o ·ª©ng d·ª•ng
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>