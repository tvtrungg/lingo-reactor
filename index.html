<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reflex - Luyện Phản Xạ Tiếng Anh & Tiếng Pháp</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
        }

        .logo {
            font-size: 20px;
            font-weight: bold;
            color: #6d6d6d;
            text-align: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 1080px;
            min-height: 96vh;
            width: 90%;
            text-align: center;
        }

        h1 {
            color: #4a5568;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .create-collection {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 20px;
        }

        .create-collection .form-group {
            flex: 1;
        }

        .tab-buttons {
            display: flex;
            justify-content: center;
            margin: 30px 0;
            background: #f7fafc;
            border-radius: 15px;
            padding: 5px;
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            margin: 0 5px;
        }

        .tab-btn.active {
            background: #4299e1;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(66, 153, 225, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4a5568;
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 148px;
        }

        .btn {
            background: linear-gradient(45deg, #4299e1, #667eea);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            font-weight: bold;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(66, 153, 225, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: linear-gradient(45deg, #e53e3e, #fc8181);
        }

        .btn-success {
            background: linear-gradient(45deg, #38a169, #68d391);
        }

        .game-area {
            background: #f7fafc;
            border-radius: 15px;
            padding: 40px;
            margin: 20px 0;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .word-display {
            font-size: 2.5em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4299e1, #667eea);
            transition: width 0.3s ease;
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
        }

        .stats-card {
            background: #a0ccf0;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            border: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .stats-number {
            font-size: 2.2em;
            font-weight: 600;
            color: #515b60;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .stats-label {
            color: #6b7280;
            font-weight: 500;
            font-size: 1.1em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stats-icon {
            font-size: 2rem;
            color: #7c3aed;
        }

        .collection-list,
        .word-list {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            text-align: left;
            max-height: 500px;
            overflow-y: auto;
        }

        .collection-item,
        .word-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
            transition: background-color 0.3s ease;
        }

        .word-item .word-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .word-item .word-text {
            flex: 1;
        }

        .collection-item:hover,
        .word-item:hover {
            background: #edf2f7;
        }

        .collection-item:last-child,
        .word-item:last-child {
            border-bottom: none;
        }

        .delete-btn {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .answer-display {
            background: #e6fffa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid #4fd1c7;
        }

        .answer-french {
            font-size: 1.8em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .answer-vietnamese {
            font-size: 1.2em;
            color: #4a5568;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            cursor: pointer;
            background: #f7fafc;
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            width: 100%;
        }

        .file-input-wrapper:hover {
            border-color: #4299e1;
            background: #ebf8ff;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #38a169;
        }

        .notification.error {
            background: #e53e3e;
        }

        .notification.info {
            background: #4299e1;
        }

        .edit-btn {
            background: #4299e1;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            margin-right: 5px;
            cursor: pointer;
        }

        .edit-form {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
        }

        .edit-form input {
            flex: 1;
            padding: 8px;
            border: 2px solid #e2e8f0;
            border-radius: 5px;
        }

        .edit-form .btn {
            padding: 8px 15px;
            font-size: 12px;
        }

        .guide-title {
            color: #2d3748;
            font-size: 1.8em;
            margin-bottom: 20px;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .guide-content {
            background: #ffffff;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            text-align: left;
        }

        .guide-section {
            margin-bottom: 30px;
        }

        .guide-section h4 {
            color: #2d3748;
            font-size: 1.4em;
            margin-bottom: 15px;
            border-left: 4px solid #4299e1;
            padding-left: 10px;
            font-weight: 600;
        }

        .guide-section p {
            color: #4a5568;
            line-height: 1.8;
            margin-bottom: 15px;
            font-size: 1em;
        }

        .guide-section ul {
            list-style-type: none;
            margin-left: 0;
            color: #4a5568;
        }

        .guide-section ul li {
            margin-bottom: 10px;
            position: relative;
            padding-left: 20px;
        }

        .guide-section ul li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #38a169;
            font-weight: bold;
        }

        .guide-section code {
            background: #f1f5f9;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
            color: #d53f8c;
        }

        .guide-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            gap: 15px;
        }

        .step-number {
            width: 40px;
            height: 40px;
            background: #4299e1;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .step-content h5 {
            color: #2d3748;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .ai-prompt-container {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border: 1px solid #e2e8f0;
        }

        .prompt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .prompt-header h5 {
            color: #2d3748;
            font-size: 1.2em;
            margin: 0;
        }

        .language-toggle {
            display: flex;
            gap: 10px;
        }

        .lang-btn {
            background: #e2e8f0;
            color: #4a5568;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s ease;
        }

        .lang-btn.active,
        .lang-btn:hover {
            background: #4299e1;
            color: white;
        }

        .prompt-content p {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.95em;
            border: 1px solid #e5e7eb;
            margin-bottom: 15px;
            line-height: 1.6;
            font-family: 'Consolas', monospace;
        }

        .ai-prompt-container ol {
            padding-left: 20px;
            margin-top: 10px;
            color: #4a5568;
        }

        .ai-prompt-container ol li {
            margin-bottom: 10px;
        }

        .ai-prompt-container h3 {
            font-size: 1.2em;
            margin: 20px 0;
        }

        .copy-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            font-size: 0.9em;
        }

        .word-checkbox {
            margin-right: 10px;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 20px;
            max-width: 1000px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .modal-close {
            float: right;
            font-size: 24px;
            cursor: pointer;
            color: #4a5568;
        }

        .modal-close:hover {
            color: #e53e3e;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                width: 95%;
            }

            .word-display {
                font-size: 1.5em;
            }

            .tab-buttons {
                flex-wrap: wrap;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .create-collection {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Language Reflex</h1>
        <i class="logo">(tvtrung)</i>

        <div class="tab-buttons">
            <button class="tab-btn active" onclick="showTab('setup')">Thiết lập</button>
            <button class="tab-btn" onclick="showTab('collection')">Bộ sưu tập</button>
            <button class="tab-btn" onclick="showTab('game')">Chơi game</button>
            <button class="tab-btn" onclick="showTab('stats')">Thống kê</button>
            <button class="tab-btn" onclick="showTab('guide')">Hướng dẫn</button>
        </div>

        <!-- Tab Thiết lập -->
        <div id="setup" class="tab-content active">
            <div class="create-collection">
                <div class="form-group">
                    <label for="collectionSelect">Chọn Bộ sưu tập:</label>
                    <select id="collectionSelect">
                        <option value="">-- Chọn hoặc tạo mới --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newCollectionName">Tên Bộ sưu tập mới (nếu có):</label>
                    <input type="text" id="newCollectionName" placeholder="Nhập tên Bộ sưu tập mới">
                </div>
            </div>
            <div class="form-group">
                <label for="wordInput">Nhập từ vựng (mỗi dòng: Tiếng Việt : Tiếng Anh/Pháp):</label>
                <textarea id="wordInput" placeholder="Ví dụ:
Xin chào : Hello hoặc Bonjour
Tạm biệt : Goodbye hoặc Au revoir
Cảm ơn : Thank you hoặc Merci
Xin lỗi : Sorry hoặc Excusez-moi
Tôi yêu bạn : I love you hoặc Je t'aime"></textarea>
            </div>

            <div class="form-group">
                <label>Hoặc tải file JSON:</label>
                <div class="file-input-wrapper">
                    <input type="file" id="fileInput" accept=".json">
                    <span>📁 Chọn file JSON hoặc kéo thả vào đây</span>
                </div>
            </div>

            <button class="btn" onclick="addWords()">Thêm từ vựng</button>
        </div>

        <!-- Tab Bộ sưu tập -->
        <div id="collection" class="tab-content">
            <div class="form-group">
                <h3 style="margin-bottom: 20px; color: #4a5568;">📚 Danh sách Bộ sưu tập</h3>
                <button class="btn btn-success" onclick="saveToFile()">💾 Lưu danh sách</button>
                <button class="btn btn-danger" onclick="clearCollections()">🗑️ Xóa tất cả</button>
            </div>

            <div id="collectionList" class="collection-list"></div>

            <div
                style="margin-top: 20px; padding: 20px; background: #f0f9ff; border-radius: 10px; border-left: 4px solid #0ea5e9;">
                <p style="margin: 0; color: #0369a1;">
                    💡 <strong>Hướng dẫn:</strong> Nhấp vào một Bộ sưu tập để xem từ vựng. Để thêm từ vựng, hãy chuyển
                    sang tab "Thiết lập" và nhập từ vựng theo định dạng: <strong>Tiếng Việt : Tiếng Anh/Pháp</strong>
                </p>
            </div>
        </div>

        <!-- Tab Chơi game -->
        <div id="game" class="tab-content">
            <div class="settings-grid">
                <div class="form-group">
                    <label for="displayTime">Thời gian hiển thị (s):</label>
                    <input type="number" id="displayTime" min="0.5" max="10" step="0.1" value="2">
                </div>
                <div class="form-group">
                    <label for="answerDisplayTime">Thời gian hiển thị đáp án (s):</label>
                    <input type="number" id="answerDisplayTime" min="1" max="10" step="0.1" value="3">
                </div>
                <div class="form-group">
                    <label for="gameMode">Chế độ chơi:</label>
                    <select id="gameMode">
                        <option value="vietnamese-to-target">Tiếng Việt → Tiếng Anh/Pháp</option>
                        <option value="target-to-vietnamese">Tiếng Anh/Pháp → Tiếng Việt</option>
                        <option value="mixed">Trộn lẫn</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="repeatCount">Số lần lặp mỗi từ:</label>
                    <input type="number" id="repeatCount" min="1" max="10" value="1">
                </div>
            </div>

            <div class="form-group">
                <label for="gameCollectionSelect">Chọn Bộ sưu tập để chơi:</label>
                <select id="gameCollectionSelect">
                    <option value="">-- Tất cả từ vựng --</option>
                </select>
            </div>
            <div class="game-area">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>

                <div id="gameDisplay">
                    <div class="word-display" id="wordDisplay">Nhấn "Bắt đầu" để chơi</div>
                </div>

                <div class="game-controls">
                    <button class="btn btn-success" id="startBtn" onclick="startGame()">▶️ Bắt đầu</button>
                    <button class="btn btn-danger" id="stopBtn" onclick="stopGame()" disabled>⏹️ Dừng</button>
                </div>

                <div id="answerDisplay" class="answer-display" style="display: none;"></div>
            </div>
        </div>

        <!-- Tab Thống kê -->
        <div id="stats" class="tab-content">
            <h3 style="margin-bottom: 20px; color: #4a5568; text-align: left;">📊 Thống kê học tập</h3>
            <div class="settings-grid">
                <div class="stats-card">
                    <div class="stats-number"><span class="stats-icon">📚</span><span id="totalWords">0</span></div>
                    <div class="stats-label">Tổng từ vựng</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number"><span class="stats-icon">🗂️</span><span id="totalCollections">0</span>
                    </div>
                    <div class="stats-label">Tổng Bộ sưu tập</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number"><span class="stats-icon">🎮</span><span id="totalSessions">0</span></div>
                    <div class="stats-label">Lần chơi</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number"><span class="stats-icon">🔍</span><span id="totalWordsShown">0</span>
                    </div>
                    <div class="stats-label">Từ đã hiển thị</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number"><span class="stats-icon">⏱️</span><span id="averageTime">0s</span></div>
                    <div class="stats-label">Thời gian TB</div>
                </div>
            </div>

            <button class="btn btn-danger" onclick="resetStats()">🔄 Đặt lại thống kê</button>
        </div>
        <!-- Tab Hướng dẫn -->
        <div id="guide" class="tab-content">
            <h3 class="guide-title">📖 Hướng dẫn sử dụng Reflex</h3>
            <div class="guide-content">
                <div class="guide-section">
                    <h4>1. Giới thiệu</h4>
                    <p>Reflex là ứng dụng web giúp bạn học từ vựng và luyện phản xạ giao tiếp tiếng Anh hoặc tiếng Pháp
                        thông qua trò chơi. Với giao diện thân thiện và tính năng quản lý từ vựng theo Bộ sưu tập, bạn
                        có thể dễ dàng tổ chức và học từ vựng hiệu quả.</p>
                </div>
                <div class="guide-section">
                    <h4>2. Hướng dẫn sử dụng các tab</h4>
                    <div class="guide-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h5>Tab Thiết lập</h5>
                            <ul>
                                <li>Nhập từ vựng theo định dạng: <code>Tiếng Việt : Tiếng Anh/Tiếng Pháp</code> (mỗi
                                    dòng một từ hoặc câu).</li>
                                <li>Chọn hoặc tạo Bộ sưu tập mới để tổ chức từ vựng theo chủ đề (ví dụ: Giao tiếp, Du
                                    lịch).</li>
                                <li>Tải file JSON để nhập nhanh danh sách từ vựng.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="guide-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h5>Tab Bộ sưu tập</h5>
                            <ul>
                                <li>Xem danh sách các Bộ sưu tập đã tạo.</li>
                                <li>Nhấp vào Bộ sưu tập để xem từ vựng trong Modal.</li>
                                <li>Chỉnh sửa hoặc xóa từ vựng bằng nút "Sửa" hoặc "Xóa".</li>
                                <li>Chọn nhiều từ bằng checkbox để xóa hàng loạt.</li>
                                <li>Lưu danh sách Bộ sưu tập ra file JSON.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="guide-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h5>Tab Chơi game</h5>
                            <ul>
                                <li>Chọn Bộ sưu tập hoặc sử dụng tất cả từ vựng để chơi.</li>
                                <li>Điều chỉnh chế độ chơi, thời gian hiển thị, và số lần lặp.</li>
                                <li>Nhấn "Bắt đầu" để luyện phản xạ với từ vựng/câu ngẫu nhiên.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="guide-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h5>Tab Thống kê</h5>
                            <ul>
                                <li>Xem tổng số từ vựng, Bộ sưu tập, lần chơi, và thời gian trung bình.</li>
                                <li>Đặt lại thống kê nếu cần.</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="guide-section">
                    <h4>3. Sử dụng AI để tạo mẫu câu giao tiếp</h4>
                    <p>Sử dụng các mô hình AI như Grok, GPT, Claude, hoặc Deepseek để tạo các mẫu câu giao tiếp tiếng
                        Anh hoặc tiếng Pháp phù hợp với trình độ của bạn.</p>
                    <div class="ai-prompt-container">
                        <div class="prompt-header">
                            <h5>Lệnh gợi ý (Prompt) cho AI</h5>
                            <div class="language-toggle">
                                <button class="lang-btn active" onclick="showPrompt('french')">Tiếng Pháp</button>
                                <button class="lang-btn" onclick="showPrompt('english')">Tiếng Anh</button>
                            </div>
                        </div>
                        <div class="prompt-content">
                            <p id="aiPromptFrench">
                                Please take on the role of a native French speaker and a French language teacher with 20
                                years of experience in teaching French communication. I am currently at the
                                <code>A2/B1/B2</code> level, but I still struggle with practical communication: I often
                                stutter, make mistakes when forming sentences, and hesitate when responding.

                                Every day, please provide me with 10 short, simple, and commonly used French phrases for
                                daily life. The goal is to help me practice speaking French naturally, without
                                translating from Vietnamese in my head.

                                Please ensure the following:

                                - The phrases are suitable for learners at the <code>A2/B1/B2</code> level.
                                - The sentences are practical and easy to apply in everyday situations.
                                - Each phrase should be followed by a clear Vietnamese translation.
                                - Present the sentences in the format: "Vietnamese meaning" : "French sentence".
                            </p>
                            <p id="aiPromptEnglish" style="display: none;">
                                Act as a native English speaker and a conversational English teacher with 20 years of
                                experience. I am currently at the <code>A2/B1/B2</code> level, but I struggle with
                                real-life communication: I stutter, form incorrect sentences, and hesitate when
                                responding.
                                Each day, provide me with 10 short, simple, and common conversational sentences used in
                                daily life. The goal is to help me practice natural English speaking without translating
                                from Vietnamese in my head.
                                Please ensure:
                                - The sentences are suitable for learners at the <code>A2/B1/B2</code> level.
                                - The sentences are practical and easily applicable in everyday situations.
                                - Include clear translations in Vietnamese.
                                - Format the sentences as: "Vietnamese meaning" : "English sentence"
                            </p>
                            <button class="btn copy-btn" onclick="copyPrompt()">📋 Sao chép Prompt</button>
                        </div>
                        <h3>Ví dụ đầu ra từ AI (Tiếng Pháp):</h3>
                        <ul>
                            <li>"Xin chào, bạn khỏe không?" : "Bonjour, tu vas bien ?"</li>
                            <li>"Tôi muốn một cà phê, làm ơn." : "Je voudrais un café, s'il vous plaît."</li>
                            <li>"Bây giờ là mấy giờ?" : "Quelle heure est-il ?"</li>
                        </ul>
                        <h3>Ví dụ đầu ra từ AI (Tiếng Anh):</h3>
                        <ul>
                            <li>"Xin chào, bạn khỏe không?" : "Hello, how are you?"</li>
                            <li>"Tôi muốn một cà phê, làm ơn." : "I’d like a coffee, please."</li>
                            <li>"Bây giờ là mấy giờ?" : "What time is it?"</li>
                        </ul>
                        <h3>Cách sử dụng:</h3>
                        <ol>
                            <li>Chọn ngôn ngữ (Tiếng Anh hoặc Tiếng Pháp) và sao chép lệnh gợi ý bằng nút "Sao chép
                                Prompt".</li>
                            <li>Thay đổi trình độ (<code>A2/B1/B2</code>) trong lệnh gợi ý để phù hợp với bạn.</li>
                            <li>Gửi lệnh gợi ý cho AI (Grok, GPT, Claude, Deepseek, v.v.).</li>
                            <li>Lấy danh sách câu trả về và nhập vào tab "Thiết lập" theo định dạng
                                <code>Tiếng Việt : Tiếng Anh/Tiếng Pháp</code>.</li>
                            <li>Sử dụng tab "Chơi game" để luyện phản xạ với các câu này.</li>
                        </ol>
                    </div>
                </div>
                <div class="guide-section">
                    <h4>4. Mẹo học hiệu quả</h4>
                    <ul>
                        <li>Tạo Bộ sưu tập theo chủ đề riêng cho từng ngôn ngữ (ví dụ: "Tiếng Anh - Giao tiếp", "Tiếng
                            Pháp - Du lịch").</li>
                        <li>Luyện tập hàng ngày với chế độ "Trộn lẫn" để tăng phản xạ.</li>
                        <li>Sử dụng AI để làm mới từ vựng và mẫu câu thường xuyên.</li>
                        <li>Theo dõi tiến độ qua tab "Thống kê" để duy trì động lực.</li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="collectionModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="modal-close" onclick="closeModal()">&times;</span>
                <h3 id="modalTitle" style="margin-bottom: 20px; color: #4a5568;"></h3>
                <div class="form-group">
                    <button class="btn btn-danger" onclick="deleteSelectedWords()" style="display: none;"
                        id="deleteSelectedBtn">🗑️ Xóa các từ đã chọn</button>
                </div>
                <div id="modalWordList" class="word-list"></div>
            </div>
        </div>
    </div>

    <script>
        let collections = [];
        let words = [];
        let currentGameWords = [];
        let currentWordIndex = 0;
        let isGameRunning = false;
        let gameInterval;
        let gamePhase = 'question'; // 'question' or 'answer'
        let gameStats = {
            totalSessions: 0,
            totalWordsShown: 0,
            totalTime: 0
        };

        // Khởi tạo ứng dụng
        function init() {
            loadCollections();
            loadStats();
            updateCollectionList();
            updateCollectionSelects();
            updateStats();
            setupFileInput();
        }

        // Chuyển đổi tab
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab-btn[onclick="showTab('${tabName}')"]`).classList.add('active');

            if (tabName === 'collection') {
                updateCollectionList();
            }
        }

        // Thêm từ vựng
        function addWords() {
            const input = document.getElementById('wordInput').value.trim();
            const collectionSelect = document.getElementById('collectionSelect').value;
            const newCollectionName = document.getElementById('newCollectionName').value.trim();

            if (!input) {
                showNotification('Vui lòng nhập từ vựng!', 'error');
                return;
            }

            let collectionId = collectionSelect;
            if (newCollectionName && !collectionSelect) {
                collectionId = Date.now().toString();
                collections.push({
                    id: collectionId,
                    name: newCollectionName,
                    words: []
                });
                showNotification(`Đã tạo Bộ sưu tập mới: ${newCollectionName}`, 'success');
            } else if (!collectionSelect) {
                showNotification('Vui lòng chọn hoặc tạo mới một Bộ sưu tập!', 'error');
                return;
            }

            const lines = input.split('\n');
            let addedCount = 0;

            lines.forEach(line => {
                const parts = line.split(':');
                if (parts.length === 2) {
                    const vietnamese = parts[0].trim();
                    const french = parts[1].trim();

                    if (vietnamese && french) {
                        const word = { vietnamese, french };
                        const collection = collections.find(c => c.id === collectionId);
                        if (collection) {
                            if (!collection.words.some(w => w.vietnamese === vietnamese && w.french === french)) {
                                collection.words.push(word);
                                addedCount++;
                            }
                        }
                        if (!words.some(w => w.vietnamese === vietnamese && w.french === french)) {
                            words.push(word);
                        }
                    }
                }
            });

            if (addedCount > 0) {
                document.getElementById('wordInput').value = '';
                document.getElementById('newCollectionName').value = '';
                saveCollections();
                saveWords();
                updateCollectionList();
                updateCollectionSelects();
                updateStats();
                showNotification(`Đã thêm ${addedCount} từ vựng vào Bộ sưu tập!`, 'success');
                showTab('collection');
            } else {
                showNotification('Không có từ vựng hợp lệ nào được thêm!', 'error');
            }
        }

        // Xóa tất cả Bộ sưu tập
        function clearCollections() {
            if (confirm('Bạn có chắc muốn xóa tất cả Bộ sưu tập?')) {
                collections = [];
                words = [];
                saveCollections();
                saveWords();
                updateCollectionList();
                updateCollectionSelects();
                updateStats();
                showNotification('Đã xóa tất cả Bộ sưu tập!', 'info');
            }
        }

        // Xóa một Bộ sưu tập
        function deleteCollection(id) {
            if (confirm('Bạn có chắc muốn xóa Bộ sưu tập này?')) {
                collections = collections.filter(c => c.id !== id);
                words = words.filter(w => !collections.some(c => c.words.some(cw => cw.vietnamese === w.vietnamese && cw.french === w.french)));
                saveCollections();
                saveWords();
                updateCollectionList();
                updateCollectionSelects();
                updateStats();
                showNotification('Đã xóa Bộ sưu tập!', 'info');
            }
        }

        // Xóa một từ vựng
        function deleteWord(collectionId, index) {
            if (confirm('Bạn có chắc muốn xóa từ này?')) {
                const collection = collections.find(c => c.id === collectionId);
                if (collection) {
                    const [removedWord] = collection.words.splice(index, 1);
                    words = words.filter(w => !(w.vietnamese === removedWord.vietnamese && w.french === removedWord.french));
                    saveCollections();
                    saveWords();
                    updateStats();
                    showCollectionWords(collectionId); // Refresh modal
                    showNotification('Đã xóa từ vựng!', 'info');
                }
            }
        }

        // Cập nhật danh sách Bộ sưu tập
        function updateCollectionList() {
            const collectionListDiv = document.getElementById('collectionList');
            if (collections.length === 0) {
                collectionListDiv.innerHTML = '<p style="text-align: center; color: #666;">Chưa có Bộ sưu tập nào. Hãy thêm từ vựng để tạo!</p>';
                return;
            }

            collectionListDiv.innerHTML = collections.map(collection => `
                <div class="collection-item" onclick="showCollectionWords('${collection.id}')" style="cursor: pointer;">
                    <span >
                        <strong>${collection.name}</strong> (${collection.words.length} từ)
                    </span>
                    <button class="delete-btn" onclick="deleteCollection('${collection.id}')">Xóa</button>
                </div>
            `).join('');
        }

        // Hiển thị từ vựng trong Bộ sưu tập qua Modal
        function showCollectionWords(collectionId) {
            const collection = collections.find(c => c.id === collectionId);
            if (!collection) return;

            const modal = document.getElementById('collectionModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalWordList = document.getElementById('modalWordList');

            modalTitle.textContent = collection.name;
            modalWordList.innerHTML = collection.words.length === 0 ?
                '<p style="text-align: center; color: #666;">Chưa có từ vựng trong Bộ sưu tập này.</p>' :
                collection.words.map((word, index) => `
                                        <div class="word-item" id="word-item-${collectionId}-${index}">
                        <input type="checkbox" class="word-checkbox" data-collection-id="${collectionId}" data-index="${index}">
                        <span class="word-text"><strong>${word.vietnamese}</strong> → ${word.french}</span>
                        <div>
                            <button class="edit-btn" onclick="editWord('${collectionId}', ${index})">Sửa</button>
                            <button class="delete-btn" onclick="deleteWord('${collectionId}', ${index})">Xóa</button>
                        </div>
                    </div>
                `).join('');

            modal.style.display = 'flex';
            // Thêm sự kiện cho checkbox
            document.querySelectorAll('.word-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', updateDeleteSelectedButton);
            });
            updateDeleteSelectedButton();
        }

        // Chỉnh sửa từ vựng
        function editWord(collectionId, index) {
            const collection = collections.find(c => c.id === collectionId);
            if (!collection) return;

            const word = collection.words[index];
            const wordItem = document.getElementById(`word-item-${collectionId}-${index}`);
            wordItem.innerHTML = `
                <div class="edit-form">
                    <input type="text" id="edit-vietnamese-${collectionId}-${index}" value="${word.vietnamese}">
                    <span> → </span>
                    <input type="text" id="edit-french-${collectionId}-${index}" value="${word.french}">
                    <div>
                        <button class="btn btn-success" onclick="saveWord('${collectionId}', ${index})">Lưu</button>
                        <button class="btn btn-danger" onclick="showCollectionWords('${collectionId}')">Hủy</button>
                    </div>
                </div>
            `;
        }

        // Lưu từ vựng sau khi chỉnh sửa
        function saveWord(collectionId, index) {
            const collection = collections.find(c => c.id === collectionId);
            if (!collection) return;

            const vietnamese = document.getElementById(`edit-vietnamese-${collectionId}-${index}`).value.trim();
            const french = document.getElementById(`edit-french-${collectionId}-${index}`).value.trim();

            if (vietnamese && french) {
                const oldWord = collection.words[index];
                collection.words[index] = { vietnamese, french };

                // Cập nhật danh sách words tổng
                const wordIndex = words.findIndex(w => w.vietnamese === oldWord.vietnamese && w.french === oldWord.french);
                if (wordIndex !== -1) {
                    words[wordIndex] = { vietnamese, french };
                } else {
                    words.push({ vietnamese, french });
                }

                saveCollections();
                saveWords();
                updateStats();
                showCollectionWords(collectionId);
                showNotification('Đã cập nhật từ vựng!', 'success');
            } else {
                showNotification('Vui lòng nhập đầy đủ từ vựng!', 'error');
            }
        }
        // Xóa các từ được chọn
        function deleteSelectedWords() {
            const checkboxes = document.querySelectorAll('.word-checkbox:checked');
            if (checkboxes.length === 0) {
                showNotification('Vui lòng chọn ít nhất một từ để xóa!', 'error');
                return;
            }

            if (confirm(`Bạn có chắc muốn xóa ${checkboxes.length} từ đã chọn?`)) {
                const collectionUpdates = {};
                checkboxes.forEach(checkbox => {
                    const collectionId = checkbox.getAttribute('data-collection-id');
                    const index = parseInt(checkbox.getAttribute('data-index'));

                    if (!collectionUpdates[collectionId]) {
                        collectionUpdates[collectionId] = [];
                    }
                    collectionUpdates[collectionId].push(index);
                });

                Object.keys(collectionUpdates).forEach(collectionId => {
                    const collection = collections.find(c => c.id === collectionId);
                    if (collection) {
                        const indices = collectionUpdates[collectionId].sort((a, b) => b - a);
                        indices.forEach(index => {
                            const [removedWord] = collection.words.splice(index, 1);
                            words = words.filter(w => !(w.vietnamese === removedWord.vietnamese && w.french === removedWord.french));
                        });
                    }
                });

                saveCollections();
                saveWords();
                updateStats();
                showCollectionWords(Object.keys(collectionUpdates)[0]); // Refresh modal with the first updated collection
                showNotification(`Đã xóa ${checkboxes.length} từ vựng!`, 'info');
            }
        }

        // Cập nhật trạng thái nút xóa nhiều từ
        function updateDeleteSelectedButton() {
            const deleteBtn = document.getElementById('deleteSelectedBtn');
            const checkboxes = document.querySelectorAll('.word-checkbox:checked');
            deleteBtn.style.display = checkboxes.length > 0 ? 'inline-block' : 'none';
        }

        // Đóng Modal
        function closeModal() {
            document.getElementById('collectionModal').style.display = 'none';
            updateCollectionList(); // Cập nhật lại danh sách Bộ sưu tập khi đóng modal
        }

        // Đóng Modal khi nhấp ra ngoài
        document.getElementById('collectionModal').addEventListener('click', function (event) {
            if (event.target === this) {
                closeModal();
            }
        });

        // Cập nhật danh sách Bộ sưu tập trong select box
        function updateCollectionSelects() {
            const collectionSelect = document.getElementById('collectionSelect');
            const gameCollectionSelect = document.getElementById('gameCollectionSelect');
            const options = collections.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            collectionSelect.innerHTML = '<option value="">-- Chọn hoặc tạo mới --</option>' + options;
            gameCollectionSelect.innerHTML = '<option value="">-- Tất cả từ vựng --</option>' + options;
        }

        // Bắt đầu game
        function startGame() {
            const collectionId = document.getElementById('gameCollectionSelect').value;
            const repeatCount = parseInt(document.getElementById('repeatCount').value) || 1;

            let gameWords = collectionId ?
                collections.find(c => c.id === collectionId)?.words || [] :
                [...words];

            if (gameWords.length === 0) {
                showNotification('Vui lòng thêm từ vựng trước khi chơi!', 'error');
                return;
            }

            isGameRunning = true;
            gamePhase = 'question';
            currentWordIndex = 0;
            currentGameWords = [];

            // Tạo danh sách từ với số lần lặp
            for (let i = 0; i < repeatCount; i++) {
                const shuffled = [...gameWords].sort(() => Math.random() - 0.5);
                currentGameWords.push(...shuffled);
            }

            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;

            gameStats.totalSessions++;
            saveStats();
            updateStats();

            showNextWord();
        }

        // Dừng game
        function stopGame() {
            isGameRunning = false;
            clearInterval(gameInterval);

            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('answerDisplay').style.display = 'none';

            document.getElementById('wordDisplay').textContent = 'Game đã dừng';
            document.getElementById('progressFill').style.width = '0%';

            showNotification('Game đã dừng!', 'info');
        }

        // Hiển thị từ tiếp theo
                // Hiển thị từ tiếp theo
                function showNextWord() {
            if (!isGameRunning || currentWordIndex >= currentGameWords.length) {
                stopGame();
                showNotification('Đã hoàn thành tất cả từ vựng!', 'success');
                return;
            }

            const currentWord = currentGameWords[currentWordIndex];
            const displayTime = parseFloat(document.getElementById('displayTime').value) * 1000;
            const answerDisplayTime = parseFloat(document.getElementById('answerDisplayTime').value) * 1000;
            const gameMode = document.getElementById('gameMode').value;

            if (gamePhase === 'question') {
                document.getElementById('answerDisplay').style.display = 'none';

                let displayText = '';
                if (gameMode === 'vietnamese-to-target') {
                    displayText = currentWord.vietnamese;
                } else if (gameMode === 'target-to-vietnamese') {
                    displayText = currentWord.french; // Assuming French as target, adjust if English is preferred
                } else { // mixed mode
                    displayText = Math.random() > 0.5 ? currentWord.vietnamese : currentWord.french;
                }

                document.getElementById('wordDisplay').textContent = displayText;

                const progress = ((currentWordIndex + 1) / currentGameWords.length) * 100;
                document.getElementById('progressFill').style.width = progress + '%';

                gameStats.totalWordsShown++;
                gameStats.totalTime += displayTime;
                saveStats();
                updateStats();

                gamePhase = 'answer';
                gameInterval = setTimeout(() => {
                    showCurrentAnswer();
                }, displayTime);
            } else if (gamePhase === 'answer') {
                currentWordIndex++;
                gamePhase = 'question';
                gameInterval = setTimeout(() => {
                    showNextWord();
                }, answerDisplayTime);
            }
        }
        
        // Hiển thị đáp án của từ hiện tại
                // Hiển thị đáp án của từ hiện tại
                function showCurrentAnswer() {
            if (!isGameRunning || currentWordIndex >= currentGameWords.length) return;

            const currentWord = currentGameWords[currentWordIndex];
            const gameMode = document.getElementById('gameMode').value;
            const currentDisplay = document.getElementById('wordDisplay').textContent;
            let answerHTML = '';

            if (gameMode === 'vietnamese-to-target') {
                answerHTML = `
                    <div class="answer-vietnamese">${currentWord.vietnamese}</div>
                    <div class="answer-french">${currentWord.french}</div>
                `;
            } else if (gameMode === 'target-to-vietnamese') {
                answerHTML = `
                    <div class="answer-french">${currentWord.french}</div>
                    <div class="answer-vietnamese">${currentWord.vietnamese}</div>
                `;
            } else { // mixed mode
                if (currentDisplay === currentWord.vietnamese) {
                    answerHTML = `
                        <div class="answer-french">${currentWord.french}</div>
                        <div class="answer-vietnamese">${currentWord.vietnamese}</div>
                    `;
                } else {
                    answerHTML = `
                        <div class="answer-vietnamese">${currentWord.vietnamese}</div>
                        <div class="answer-french">${currentWord.french}</div>
                    `;
                }
            }

            document.getElementById('answerDisplay').innerHTML = answerHTML;
            document.getElementById('answerDisplay').style.display = 'block';

            showNextWord();
        }

        // Lưu Collections
        function saveCollections() {
            localStorage.setItem('frenchCollections', JSON.stringify(collections));
        }

        // Tải Collections
        function loadCollections() {
            const savedCollections = localStorage.getItem('frenchCollections');
            if (savedCollections) {
                collections = JSON.parse(savedCollections);
                collections.forEach(c => {
                    c.words.forEach(w => {
                        if (!words.some(wd => wd.vietnamese === w.vietnamese && wd.french === w.french)) {
                            words.push(w);
                        }
                    });
                });
            }
        }

        // Lưu từ vựng
        function saveWords() {
            localStorage.setItem('frenchWords', JSON.stringify(words));
        }

        // Tải từ vựng
        function loadWords() {
            const savedWords = localStorage.getItem('frenchWords');
            if (savedWords) {
                words = JSON.parse(savedWords);
            }
        }

        // Lưu thống kê
        function saveStats() {
            localStorage.setItem('frenchGameStats', JSON.stringify(gameStats));
        }

        // Tải thống kê
        function loadStats() {
            const savedStats = localStorage.getItem('frenchGameStats');
            if (savedStats) {
                gameStats = JSON.parse(savedStats);
            }
        }

        // Cập nhật thống kê
        function updateStats() {
            document.getElementById('totalWords').textContent = words.length;
            document.getElementById('totalCollections').textContent = collections.length;
            document.getElementById('totalSessions').textContent = gameStats.totalSessions;
            document.getElementById('totalWordsShown').textContent = gameStats.totalWordsShown;

            const avgTime = gameStats.totalWordsShown > 0 ?
                (gameStats.totalTime / gameStats.totalWordsShown / 1000).toFixed(1) : 0;
            document.getElementById('averageTime').textContent = avgTime + 's';
        }

        // Đặt lại thống kê
        function resetStats() {
            if (confirm('Bạn có chắc muốn đặt lại tất cả thống kê?')) {
                gameStats = {
                    totalSessions: 0,
                    totalWordsShown: 0,
                    totalTime: 0
                };
                saveStats();
                updateStats();
                showNotification('Đã đặt lại thống kê!', 'info');
            }
        }

        // Lưu danh sách từ vựng ra file JSON
        function saveToFile() {
            if (collections.length === 0) {
                showNotification('Không có Bộ sưu tập nào để lưu!', 'error');
                return;
            }

            const dataStr = JSON.stringify(collections, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);

            const exportFileDefaultName = 'french-collections.json';
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();

            showNotification('Đã lưu file thành công!', 'success');
        }

        // Thiết lập file input
        function setupFileInput() {
            const fileInput = document.getElementById('fileInput');
            fileInput.addEventListener('change', handleFileSelect);
        }

        // Xử lý file được chọn
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file && file.type === 'application/json') {
                const reader = new FileReader();
                reader.onload = function (e) {
                    try {
                        const importedCollections = JSON.parse(e.target.result);
                        if (Array.isArray(importedCollections)) {
                            collections = importedCollections;
                            words = [];
                            collections.forEach(c => {
                                c.words.forEach(w => {
                                    if (!words.some(wd => wd.vietnamese === w.vietnamese && wd.french === w.french)) {
                                        words.push(w);
                                    }
                                });
                            });
                            saveCollections();
                            saveWords();
                            updateCollectionList();
                            updateCollectionSelects();
                            updateStats();
                            showNotification(`Đã tải ${collections.length} Bộ sưu tập!`, 'success');
                            showTab('collection');
                        } else {
                            showNotification('File JSON không đúng định dạng!', 'error');
                        }
                    } catch (error) {
                        showNotification('Lỗi khi đọc file JSON!', 'error');
                    }
                };
                reader.readAsText(file);
            } else {
                showNotification('Vui lòng chọn file JSON!', 'error');
            }
        }

        // Hiển thị thông báo
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Hiển thị prompt theo ngôn ngữ
        function showPrompt(language) {
            const frenchPrompt = document.getElementById('aiPromptFrench');
            const englishPrompt = document.getElementById('aiPromptEnglish');
            const frenchBtn = document.querySelector('.lang-btn[onclick="showPrompt(\'french\')"]');
            const englishBtn = document.querySelector('.lang-btn[onclick="showPrompt(\'english\')"]');

            if (language === 'french') {
                frenchPrompt.style.display = 'block';
                englishPrompt.style.display = 'none';
                frenchBtn.classList.add('active');
                englishBtn.classList.remove('active');
            } else {
                frenchPrompt.style.display = 'none';
                englishPrompt.style.display = 'block';
                frenchBtn.classList.remove('active');
                englishBtn.classList.add('active');
            }
        }

        // Sao chép prompt
        function copyPrompt() {
            const frenchPrompt = document.getElementById('aiPromptFrench');
            const englishPrompt = document.getElementById('aiPromptEnglish');
            const activePrompt = frenchPrompt.style.display === 'block' ? frenchPrompt : englishPrompt;

            navigator.clipboard.writeText(activePrompt.textContent.trim())
                .then(() => showNotification('Đã sao chép prompt!', 'success'))
                .catch(() => showNotification('Lỗi khi sao chép prompt!', 'error'));
        }

        // Khởi tạo ứng dụng
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>